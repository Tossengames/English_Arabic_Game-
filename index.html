<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ch≈ç-Han: Grand Den</title>
    <style>
        :root {
            --tatami: #b8af8b;
            --wood: #2c1e16;
            --red: #8b0000;
            --gold: #d4af37;
            --win: #2e7d32;
            --lose: #c62828;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            height: 100vh;
        }

        #game-view {
            width: 100%;
            max-width: 500px;
            background: var(--wood);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* LOG TICKER (TOP) */
        #log-ticker {
            height: 30px;
            background: rgba(0,0,0,0.8);
            border-bottom: 1px solid var(--gold);
            color: var(--gold);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            overflow: hidden;
        }

        /* THE MAT (CENTER) */
        #tatami {
            flex: 1.2;
            background: var(--tatami);
            margin: 0 15px;
            border: 8px solid #3d2b1f;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.4);
        }

        .cup { font-size: 100px; z-index: 10; transition: transform 0.3s; }
        .dice-reveal { font-size: 45px; position: absolute; top: 50%; display: flex; gap: 15px; }

        /* UI CONTROLS (MIDDLE) */
        #ui-layer {
            flex: 1;
            background: rgba(10,10,10,0.95);
            padding: 15px;
            border-top: 3px solid var(--gold);
            z-index: 20;
        }

        .player-header { text-align: center; margin-bottom: 10px; }
        .stepper { display: flex; justify-content: center; align-items: center; gap: 10px; }
        .stepper button { flex: 0; min-width: 50px; background: #333; }
        
        button {
            padding: 12px;
            border: 1px solid var(--gold);
            background: var(--red);
            color: white;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }

        .bet-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }

        /* RESULT TABS */
        #result-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .res-card {
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.8rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* VFX CLASS */
        .shake-camera { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .dust-cloud { position: absolute; pointer-events: none; animation: poof 0.5s ease-out forwards; }
        @keyframes poof {
            0% { transform: scale(0.5); opacity: 0.8; }
            100% { transform: scale(3); opacity: 0; }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-view">
    <div id="log-ticker">WELCOME TO THE DEN...</div>

    <div id="tatami">
        <div id="cup" class="cup">üè∫</div>
        <div id="dice-reveal" class="dice-reveal hidden"></div>
        <button id="call-out" class="hidden" style="position:absolute; bottom:20px; z-index:30; background:orange; color:black;" onclick="doCallOut()">CALL CHEAT!</button>
    </div>

    <div id="ui-layer">
        <div id="setup-ui">
            <h3 style="text-align:center">Gamble with:</h3>
            <div class="bet-grid">
                <button onclick="start(1, 1)">1 Human + 1 AI</button>
                <button onclick="start(1, 3)">1 Human + 3 AI</button>
                <button onclick="start(2, 0)">2 Humans</button>
                <button onclick="start(4, 4)">4 Humans + 4 AI</button>
            </div>
        </div>

        <div id="betting-ui" class="hidden">
            <div class="player-header">
                <span id="p-name" style="font-size:1.3rem; border-bottom: 2px solid;">NAME</span><br>
                <span id="p-money" style="color:var(--gold)">1000</span> Mon
            </div>
            <div class="stepper">
                <button onclick="modBet(-50)">-50</button>
                <input type="number" id="bet-amt" value="100" style="width:70px; text-align:center; background:#000; color:var(--gold); border:1px solid var(--gold);">
                <button onclick="modBet(50)">+50</button>
            </div>
            <div class="bet-grid">
                <button onclick="makeBet('Ch≈ç')">CH≈å (Even)</button>
                <button onclick="makeBet('Han')">HAN (Odd)</button>
            </div>
        </div>

        <div id="results-ui" class="hidden">
            <h3 id="round-winner-title" style="text-align:center; margin:0;">-</h3>
            <div id="result-display"></div>
            <button onclick="nextRound()" style="width:100%; margin-top:10px;">NEXT ROUND</button>
        </div>
    </div>
</div>

<script>
    let players = [];
    let bets = [];
    let curIdx = 0;
    let houseCheat = false;
    let resultOutcome = "";
    const icons = ['','‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
    const pColors = ['#ff5252', '#448aff', '#ffeb3b', '#e040fb', '#18ffff', '#7cff00', '#ff9100', '#ff4081'];

    function ticker(msg) { document.getElementById('log-ticker').innerText = msg; }

    function start(humans, ais) {
        players = [];
        for(let i=0; i<humans; i++) players.push({ name: "Player "+(i+1), money: 1000, isAI: false, color: pColors[i] });
        for(let i=0; i<ais; i++) players.push({ name: "CPU "+(i+1), money: 1000, isAI: true, color: '#999' });
        document.getElementById('setup-ui').classList.add('hidden');
        newRound();
    }

    function newRound() {
        curIdx = 0; bets = []; houseCheat = false;
        document.getElementById('cup').style.transform = "translateY(0)";
        document.getElementById('dice-reveal').classList.add('hidden');
        document.getElementById('results-ui').classList.add('hidden');
        document.getElementById('call-out').classList.add('hidden');
        processTurn();
    }

    function modBet(v) {
        let inp = document.getElementById('bet-amt');
        let val = parseInt(inp.value) + v;
        if(val < 10) val = 10;
        if(val > players[curIdx].money) val = players[curIdx].money;
        inp.value = val;
    }

    function processTurn() {
        if(curIdx < players.length) {
            let p = players[curIdx];
            if(p.money <= 0) { curIdx++; processTurn(); return; }
            
            if(p.isAI) {
                ticker(p.name + " is thinking...");
                setTimeout(() => {
                    let choice = Math.random() > 0.5 ? 'Ch≈ç' : 'Han';
                    let amt = Math.floor(Math.random() * (p.money * 0.3)) + 10;
                    bets.push({ type: choice, amt: amt });
                    curIdx++; processTurn();
                }, 600);
            } else {
                document.getElementById('betting-ui').classList.remove('hidden');
                document.getElementById('p-name').innerText = p.name;
                document.getElementById('p-name').style.borderColor = p.color;
                document.getElementById('p-money').innerText = p.money;
                document.getElementById('bet-amt').value = 50;
            }
        } else {
            document.getElementById('betting-ui').classList.add('hidden');
            roll();
        }
    }

    function makeBet(type) {
        let amt = parseInt(document.getElementById('bet-amt').value);
        bets.push({ type, amt });
        curIdx++;
        processTurn();
    }

    function roll() {
        ticker("DEALER SHAKES THE CUP...");
        const cup = document.getElementById('cup');
        cup.classList.add('shake-camera');
        
        setTimeout(() => {
            cup.classList.remove('shake-camera');
            cup.style.transform = "translateY(-120px)";
            vfxDust();
            
            let d1 = Math.floor(Math.random()*6)+1;
            let d2 = Math.floor(Math.random()*6)+1;
            if(Math.random() < 0.2) houseCheat = true; // Dealer nudges

            let sum = d1 + d2;
            resultOutcome = (sum % 2 === 0) ? 'Ch≈ç' : 'Han';
            document.getElementById('dice-reveal').innerHTML = `<span>${icons[d1]}</span><span>${icons[d2]}</span>`;
            document.getElementById('dice-reveal').classList.remove('hidden');
            
            document.getElementById('call-out').classList.remove('hidden');
            ticker("RESULT: " + resultOutcome.toUpperCase());
            showResults();
        }, 1200);
    }

    function showResults() {
        document.getElementById('results-ui').classList.remove('hidden');
        document.getElementById('round-winner-title').innerText = resultOutcome.toUpperCase();
        const grid = document.getElementById('result-display');
        grid.innerHTML = "";

        players.forEach((p, i) => {
            if(p.money <= 0 && !bets[i]) return;
            let b = bets[i];
            let won = (b.type === resultOutcome);
            let color = won ? 'var(--win)' : 'var(--lose)';
            grid.innerHTML += `
                <div class="res-card" style="background:${color}; border-top: 4px solid ${p.color}">
                    <strong>${p.name}</strong><br>
                    ${won ? '+'+b.amt : '-'+b.amt} Mon
                </div>
            `;
            if(won) p.money += b.amt; else p.money -= b.amt;
        });
    }

    function vfxDust() {
        const dust = document.createElement('div');
        dust.className = 'dust-cloud';
        dust.innerHTML = "üí®";
        document.getElementById('tatami').appendChild(dust);
        setTimeout(() => dust.remove(), 500);
    }

    function doCallOut() {
        document.getElementById('call-out').classList.add('hidden');
        document.getElementById('game-view').classList.add('shake-camera');
        setTimeout(() => document.getElementById('game-view').classList.remove('shake-camera'), 300);

        if(houseCheat) {
            ticker("CHEATER! Dealer was caught!");
            players.forEach((p, i) => { if(bets[i]) p.money += (bets[i].amt * 2); });
        } else {
            ticker("INNOCENT! Dealer fines you all!");
            players.forEach(p => p.money = Math.floor(p.money * 0.7));
        }
        showResults();
    }

    function nextRound() {
        if(players.every(p => p.money <= 0)) { alert("All Gamblers Broke!"); location.reload(); }
        newRound();
    }
</script>
</body>
</html>
