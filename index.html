<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ch≈ç-Han: The Great Hall</title>
    <style>
        :root {
            --tatami: #c5ba9a;
            --wood: #2c1e16;
            --red: #8b0000;
            --gold: #d4af37;
            --win: #2e7d32;
            --lose: #c62828;
        }

        body {
            background: #000; color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden;
            display: flex; justify-content: center; height: 100vh;
        }

        #game-view {
            width: 100%; max-width: 500px;
            background: var(--wood);
            display: flex; flex-direction: column; position: relative;
        }

        #log-ticker {
            height: 35px; background: #000; color: var(--gold);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; border-bottom: 2px solid var(--gold);
            text-transform: uppercase;
        }

        /* THE TATAMI */
        #tatami {
            flex: 1.3; background: var(--tatami);
            margin: 10px; border: 12px solid #3d2b1f;
            position: relative; display: flex; justify-content: center; align-items: center;
        }

        .cup { font-size: 80px; z-index: 10; transition: 0.5s; }
        .dice-reveal { font-size: 40px; position: absolute; z-index: 11; display: flex; gap: 10px; }

        /* PLAYER SPOTS */
        .player-spot {
            position: absolute; width: 60px; text-align: center;
            font-size: 0.7rem; font-weight: bold; transition: all 0.4s;
            display: flex; flex-direction: column; align-items: center;
        }

        .coin-visual {
            width: 30px; height: 30px; border-radius: 50%;
            border: 2px solid #444; background: #222; color: #fff;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 4px; font-size: 0.6rem;
        }

        /* Circular Positioning */
        .spot-0 { top: 5%; left: 42%; }
        .spot-1 { top: 15%; right: 10%; }
        .spot-2 { top: 50%; right: 2%; transform: translateY(-50%); }
        .spot-3 { bottom: 15%; right: 10%; }
        .spot-4 { bottom: 5%; left: 42%; }
        .spot-5 { bottom: 15%; left: 10%; }
        .spot-6 { top: 50%; left: 2%; transform: translateY(-50%); }
        .spot-7 { top: 15%; left: 10%; }

        /* ANIMATED FLYING TEXT */
        .payout-particle {
            position: absolute; font-weight: bold; font-size: 1.2rem;
            pointer-events: none; z-index: 20; transition: all 0.8s ease-in-out;
        }

        /* UI LAYER */
        #ui-layer {
            flex: 1; background: rgba(15,15,15,0.98);
            padding: 15px; border-top: 3px solid var(--gold); overflow-y: auto;
        }

        .setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .setup-item { background: #222; padding: 5px; border-radius: 4px; border: 1px solid #444; }
        .setup-item input { width: 60px; background: #000; color: #fff; border: 1px solid var(--gold); font-size: 0.7rem; }
        
        .active-turn .coin-visual { border-color: var(--gold); background: #fff; color: #000; transform: scale(1.3); }
        .shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0%{transform:rotate(1deg)} 100%{transform:rotate(-1deg)} }
        
        .hidden { display: none !important; }
        button { cursor: pointer; background: var(--red); color: white; border: 1px solid var(--gold); padding: 10px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-view">
    <div id="log-ticker">SETTLE YOUR DEBTS...</div>

    <div id="tatami">
        <div id="cup" class="cup">üè∫</div>
        <div id="dice-reveal" class="dice-reveal hidden"></div>
        
        <div id="spots-container"></div>
    </div>

    <div id="ui-layer">
        <div id="setup-ui">
            <div id="setup-controls" class="setup-grid"></div>
            <button onclick="startGame()" style="width:100%; margin-top:15px;">START GAMBLING</button>
        </div>

        <div id="betting-ui" class="hidden" style="text-align:center;">
            <h2 id="p-display-name" style="margin:0;"></h2>
            <p id="p-display-money" style="color:var(--gold); margin:5px 0;"></p>
            <div style="margin:10px 0;">
                <button onclick="modBet(-50)">-</button>
                <input type="number" id="bet-amt" value="50" style="width:70px; text-align:center; background:#000; color:#fff; border:1px solid var(--gold); font-size:1.2rem;">
                <button onclick="modBet(50)">+</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button onclick="placeBet('Ch≈ç')" style="flex:1">CH≈å (Even)</button>
                <button onclick="placeBet('Han')" style="flex:1">HAN (Odd)</button>
            </div>
        </div>

        <div id="results-ui" class="hidden" style="text-align:center;">
            <h2 id="final-result-text"></h2>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button id="call-cheat-btn" style="flex:1; background:orange; color:#000;" onclick="callCheat()">CALL CHEAT</button>
                <button onclick="newRound()" style="flex:1">NEXT ROUND</button>
            </div>
        </div>
    </div>
</div>

<script>
    const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#18FFFF', '#64FFDA'];
    let players = [];
    let bets = [];
    let curIdx = 0;
    let isCheating = false;
    let roundResult = "";

    // Generate Setup UI
    const setupBox = document.getElementById('setup-controls');
    for(let i=0; i<8; i++) {
        setupBox.innerHTML += `
            <div class="setup-item" style="border-left: 4px solid ${colors[i]}">
                <input type="text" id="name-${i}" value="Player ${i+1}">
                <button onclick="toggleType(${i})" id="type-${i}" style="font-size:0.6rem; padding:2px 5px;">HUMAN</button>
            </div>
        `;
    }

    let config = Array(8).fill(false); // false = Human
    function toggleType(i) {
        config[i] = !config[i];
        document.getElementById(`type-${i}`).innerText = config[i] ? "CPU" : "HUMAN";
    }

    function ticker(m) { document.getElementById('log-ticker').innerText = m; }

    function startGame() {
        players = config.map((isAI, i) => ({
            name: document.getElementById(`name-${i}`).value,
            money: 1000,
            isAI: isAI,
            color: colors[i]
        }));
        
        const spotCont = document.getElementById('spots-container');
        spotCont.innerHTML = players.map((p, i) => `
            <div id="spot-${i}" class="player-spot spot-${i}">
                <div class="coin-visual" id="coin-${i}">-</div>
                <div style="color:${p.color}">${p.name}</div>
            </div>
        `).join('');

        document.getElementById('setup-ui').classList.add('hidden');
        newRound();
    }

    function newRound() {
        curIdx = 0; bets = []; isCheating = false;
        document.getElementById('cup').style.transform = "translateY(0)";
        document.getElementById('dice-reveal').classList.add('hidden');
        document.getElementById('results-ui').classList.add('hidden');
        document.getElementById('call-cheat-btn').classList.remove('hidden');
        players.forEach((p, i) => {
            const c = document.getElementById(`coin-${i}`);
            c.innerText = "-";
            c.style.background = "#222";
        });
        nextTurn();
    }

    function nextTurn() {
        if(curIdx < 8) {
            let p = players[curIdx];
            if(p.money <= 0) { curIdx++; nextTurn(); return; }

            document.querySelectorAll('.player-spot').forEach(s => s.classList.remove('active-turn'));
            document.getElementById(`spot-${curIdx}`).classList.add('active-turn');

            if(p.isAI) {
                ticker(p.name + " is thinking...");
                setTimeout(() => {
                    let type = Math.random() > 0.5 ? 'Ch≈ç' : 'Han';
                    let amt = Math.floor(Math.random() * 100) + 50;
                    confirmBet(type, Math.min(amt, p.money));
                }, 1000);
            } else {
                ticker("Betting: " + p.name);
                document.getElementById('betting-ui').classList.remove('hidden');
                document.getElementById('p-display-name').innerText = p.name;
                document.getElementById('p-display-name').style.color = p.color;
                document.getElementById('p-display-money').innerText = p.money + " Mon";
            }
        } else {
            document.getElementById('betting-ui').classList.add('hidden');
            reveal();
        }
    }

    function modBet(v) {
        const inp = document.getElementById('bet-amt');
        let n = parseInt(inp.value) + v;
        inp.value = Math.max(10, Math.min(n, players[curIdx].money));
    }

    function placeBet(type) {
        confirmBet(type, parseInt(document.getElementById('bet-amt').value));
    }

    function confirmBet(type, amt) {
        bets[curIdx] = { type, amt };
        document.getElementById(`coin-${curIdx}`).innerText = amt;
        document.getElementById(`coin-${curIdx}`).style.background = (type === 'Ch≈ç') ? '#444' : '#888';
        document.getElementById('betting-ui').classList.add('hidden');
        curIdx++;
        setTimeout(nextTurn, 400);
    }

    function reveal() {
        const cup = document.getElementById('cup');
        cup.classList.add('shake');
        ticker("DEALER SHAKES THE CUP...");

        setTimeout(() => {
            cup.classList.remove('shake');
            cup.style.transform = "translateY(-120px)";
            
            let d1 = Math.floor(Math.random()*6)+1;
            let d2 = Math.floor(Math.random()*6)+1;
            if(Math.random() < 0.15) isCheating = true;

            roundResult = ((d1+d2) % 2 === 0) ? 'Ch≈ç' : 'Han';
            const icons = ['','‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
            document.getElementById('dice-reveal').innerHTML = `<span>${icons[d1]}</span><span>${icons[d2]}</span>`;
            document.getElementById('dice-reveal').classList.remove('hidden');
            
            ticker("RESULT: " + roundResult.toUpperCase());
            animatePayouts();
        }, 1500);
    }

    async function animatePayouts() {
        document.getElementById('results-ui').classList.remove('hidden');
        document.getElementById('final-result-text').innerText = roundResult.toUpperCase();

        for(let i=0; i<8; i++) {
            if(!bets[i]) continue;
            const won = bets[i].type === roundResult;
            const spot = document.getElementById(`spot-${i}`);
            const coin = document.getElementById(`coin-${i}`);
            
            // Create particle
            const p = document.createElement('div');
            p.className = 'payout-particle';
            p.innerText = won ? "+" + bets[i].amt : "-" + bets[i].amt;
            p.style.color = won ? 'var(--win)' : 'var(--lose)';
            p.style.left = '50%'; p.style.top = '50%';
            document.getElementById('tatami').appendChild(p);

            // Animate to player spot
            const rect = spot.getBoundingClientRect();
            const matRect = document.getElementById('tatami').getBoundingClientRect();
            
            setTimeout(() => {
                p.style.left = (rect.left - matRect.left + 20) + 'px';
                p.style.top = (rect.top - matRect.top + 20) + 'px';
                p.style.opacity = '0';
                
                // Update player visual
                coin.style.background = won ? 'var(--win)' : 'var(--lose)';
                if(won) players[i].money += bets[i].amt; else players[i].money -= bets[i].amt;
            }, 50);

            await new Promise(r => setTimeout(r, 400)); // One by one delay
            p.remove();
        }
    }

    function callCheat() {
        document.getElementById('call-cheat-btn').classList.add('hidden');
        if(isCheating) {
            ticker("CAUGHT! Dealer pays back triple!");
            players.forEach((p, i) => { if(bets[i]) p.money += (bets[i].amt * 2); });
        } else {
            ticker("FALSE ACCUSE! Dealer takes 50% extra!");
            players.forEach(p => p.money = Math.floor(p.money * 0.5));
        }
    }
</script>
</body>
</html>
