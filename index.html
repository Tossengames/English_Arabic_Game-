<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sky Road Runner</title>
    <style>
        body { margin: 0; overflow: hidden; background: #00b894; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #menu {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 30px; border-radius: 15px;
            display: flex; flex-direction: column; gap: 10px; width: 260px; z-index: 10;
        }
        #scoreUI { position: absolute; top: 20px; width: 100%; text-align: center; color: white; font-size: 50px; font-weight: bold; pointer-events: none; text-shadow: 2px 2px 0px #000; }
        input { padding: 8px; border: 1px solid #ddd; }
        button { padding: 15px; background: #0984e3; color: white; border: none; font-weight: bold; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="scoreUI" style="display:none;">0</div>
    <div id="menu">
        <h2 style="margin-top:0">Settings</h2>
        <label>Road Width:</label>
        <input type="number" id="roadWidth" value="180">
        <label>Game Speed:</label>
        <input type="number" id="gameSpeed" value="5">
        <button onclick="startGame()">START RACE</button>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let gameActive = false;
let score = 0;
let roadBlocks = [];
let incoming = null;
let speed = 5;
let roadW = 180;
let difficulty = 1;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function startGame() {
    roadW = parseInt(document.getElementById('roadWidth').value);
    speed = parseFloat(document.getElementById('gameSpeed').value);
    
    document.getElementById('menu').style.display = 'none';
    document.getElementById('scoreUI').style.display = 'block';
    
    score = 0;
    difficulty = 1;
    roadBlocks = [];
    
    // Starting Road (3 blocks)
    for(let i = 0; i < 4; i++) {
        roadBlocks.push({
            x: canvas.width/2 - roadW/2,
            y: canvas.height - (i * 150) - 150,
            w: roadW,
            h: 150
        });
    }
    
    incoming = null;
    gameActive = true;
    loop();
}

function spawnBlock() {
    if (incoming) return;
    const last = roadBlocks[roadBlocks.length - 1];
    const width = roadW * (0.8 + Math.random() * 1.5);
    const side = Math.random() > 0.5 ? -width : canvas.width;
    
    incoming = {
        x: side,
        y: last.y - 150,
        w: width,
        h: 150,
        vx: (side < 0 ? 1 : -1) * (speed * 1.5 * difficulty)
    };
}

function stopBlock() {
    if (!gameActive || !incoming) return;
    roadBlocks.push({...incoming});
    incoming = null;
    score++;
    difficulty += 0.05;
}

window.addEventListener('mousedown', stopBlock);
window.addEventListener('touchstart', (e) => { e.preventDefault(); stopBlock(); });

function loop() {
    if (!gameActive) return;

    // 1. Move everything down (simulating car moving forward)
    let moveStep = speed * difficulty;
    roadBlocks.forEach(b => b.y += moveStep);
    if (incoming) {
        incoming.y += moveStep;
        incoming.x += incoming.vx;
        // Keep incoming block bouncing on screen
        if (incoming.x < 0 || incoming.x + incoming.w > canvas.width) incoming.vx *= -1;
    }

    // 2. Spawn Logic: If car passes middle of a block, spawn next
    // Car is effectively at bottom: canvas.height - 100
    if (roadBlocks.length < 6) spawnBlock();

    // 3. Clean up old blocks
    if (roadBlocks[0].y > canvas.height) roadBlocks.shift();

    // 4. Fall Logic
    // Check which block is currently under the car
    let carX = canvas.width / 2;
    let currentBlock = roadBlocks.find(b => b.y + b.h > canvas.height - 80 && b.y < canvas.height - 80);
    
    if (!currentBlock || carX < currentBlock.x || carX > currentBlock.x + currentBlock.w) {
        gameActive = false;
        alert("GAME OVER! Score: " + score);
        location.reload();
    }

    draw();
    requestAnimationFrame(loop);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw Sky/Horizon
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw Road Blocks
    roadBlocks.forEach((b, index) => {
        // Perspective effect: higher blocks are slightly narrower
        let scale = 1 - ( (canvas.height - b.y) / canvas.height ) * 0.5;
        let visualW = b.w * scale;
        let visualX = (b.x - canvas.width/2) * scale + canvas.width/2;

        ctx.fillStyle = "#34495e";
        ctx.fillRect(visualX, b.y, visualW, b.h);
        
        // Lines on road
        ctx.strokeStyle = "rgba(255,255,255,0.5)";
        ctx.lineWidth = 2;
        ctx.strokeRect(visualX, b.y, visualW, b.h);
    });

    // Draw Incoming Block
    if (incoming) {
        ctx.fillStyle = "#e74c3c";
        ctx.fillRect(incoming.x, incoming.y, incoming.w, incoming.h);
    }

    // Draw Car (Static at bottom center)
    const cw = 50; const ch = 80;
    const cx = canvas.width/2 - cw/2;
    const cy = canvas.height - 120;
    
    // Car Body
    ctx.fillStyle = "yellow";
    ctx.fillRect(cx, cy, cw, ch);
    // Windshield
    ctx.fillStyle = "black";
    ctx.fillRect(cx + 5, cy + 10, cw - 10, 15);
    // Tail lights
    ctx.fillStyle = "red";
    ctx.fillRect(cx + 5, cy + ch - 10, 10, 5);
    ctx.fillRect(cx + cw - 15, cy + ch - 10, 10, 5);

    document.getElementById('scoreUI').innerText = score;
}
</script>
</body>
</html>
