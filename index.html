<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch≈ç-Han: Edo Dice Game</title>
    <style>
        :root {
            --edo-red: #b32d2e;
            --gold: #d4af37;
            --ink: #1a1a1b;
            --paper: #f4e4bc;
            --win-green: #2d5a27;
        }

        body {
            background-color: var(--ink);
            color: var(--paper);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
            transition: background-color 0.5s ease;
        }

        .game-container {
            width: 100%;
            max-width: 450px;
            background: #252525;
            border: 3px solid var(--gold);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            text-align: center;
        }

        h1 { color: var(--edo-red); letter-spacing: 4px; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }
        .hidden { display: none; }

        /* UI Elements */
        .instruction-box { font-size: 0.9rem; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin-bottom: 20px; text-align: left; }
        input, select { padding: 12px; margin: 10px 0; width: 80%; border-radius: 8px; border: 1px solid var(--gold); background: #111; color: white; }
        
        button {
            background: var(--edo-red);
            color: white;
            border: 2px solid var(--gold);
            padding: 15px 30px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            margin: 10px;
            border-radius: 5px;
        }

        button:active { transform: scale(0.95); }

        /* Betting Area */
        .stats { color: var(--gold); font-size: 1.2rem; margin-bottom: 10px; }
        .bet-buttons { display: flex; justify-content: center; gap: 10px; }

        /* VFX */
        .dice-reveal { font-size: 5rem; margin: 20px 0; min-height: 120px; }
        .shaking { animation: shake 0.15s infinite; }
        @keyframes shake {
            0% { transform: rotate(1deg) scale(1.1); }
            50% { transform: rotate(-1deg) scale(1.1); }
            100% { transform: rotate(1deg) scale(1.1); }
        }

        .flash-win { background-color: var(--win-green) !important; }
        .flash-loss { background-color: var(--edo-red) !important; }

        .result-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #444; }
    </style>
</head>
<body>

<div class="game-container" id="game-ui">
    <h1>CH≈å-HAN</h1>

    <div id="setup-screen">
        <div class="instruction-box">
            <strong>HOW TO PLAY:</strong><br>
            1. Pick the number of players.<br>
            2. Each gets a random starting purse.<br>
            3. Bet on <strong>CH≈å</strong> (Even) or <strong>HAN</strong> (Odd).<br>
            4. If you win, you double your bet!
        </div>
        <p>Select Gamblers:</p>
        <select id="player-count">
            <option value="1">1 Player</option>
            <option value="2">2 Players</option>
            <option value="4">4 Players</option>
            <option value="8">8 Players</option>
        </select>
        <div id="name-fields"></div>
        <button onclick="initPlayers()">START GAME</button>
    </div>

    <div id="betting-screen" class="hidden">
        <h2 id="turn-display">Player's Turn</h2>
        <div class="stats">Purse: <span id="purse-display">0</span> Mon</div>
        <input type="number" id="bet-amount" placeholder="Enter Bet Amount" min="1">
        <div class="bet-buttons">
            <button onclick="submitBet('Ch≈ç')" style="background:#444">CH≈å<br>(Even)</button>
            <button onclick="submitBet('Han')" style="background:#444">HAN<br>(Odd)</button>
        </div>
    </div>

    <div id="reveal-screen" class="hidden">
        <div id="dice-visual" class="dice-reveal">üèÆ</div>
        <h2 id="outcome-text">Shaking the cup...</h2>
        <div id="leaderboard"></div>
        <button id="next-btn" class="hidden" onclick="startNewRound()">NEXT ROUND</button>
    </div>
</div>

<script>
    let players = [];
    let currentBets = [];
    let currentPlayerIdx = 0;

    // Build name inputs
    document.getElementById('player-count').addEventListener('change', (e) => {
        const div = document.getElementById('name-fields');
        div.innerHTML = '';
        for(let i=1; i<=e.target.value; i++) {
            div.innerHTML += `<input type="text" id="name-${i}" value="Player ${i}">`;
        }
    });
    document.getElementById('player-count').dispatchEvent(new Event('change'));

    function initPlayers() {
        const count = document.getElementById('player-count').value;
        players = [];
        for(let i=1; i<=count; i++) {
            players.push({
                name: document.getElementById(`name-${i}`).value,
                money: Math.floor(Math.random() * 1000) + 500 // Random 500-1500
            });
        }
        document.getElementById('setup-screen').classList.add('hidden');
        startNewRound();
    }

    function startNewRound() {
        currentPlayerIdx = 0;
        currentBets = [];
        document.body.className = '';
        document.getElementById('reveal-screen').classList.add('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        updateBettingUI();
    }

    function updateBettingUI() {
        if (currentPlayerIdx < players.length) {
            const p = players[currentPlayerIdx];
            if (p.money <= 0) {
                // Skip bankrupt players
                currentBets.push({ type: 'Ch≈ç', amount: 0, bankrupt: true });
                currentPlayerIdx++;
                updateBettingUI();
                return;
            }
            document.getElementById('betting-screen').classList.remove('hidden');
            document.getElementById('turn-display').innerText = `${p.name}'s Bet`;
            document.getElementById('purse-display').innerText = p.money;
            document.getElementById('bet-amount').value = Math.floor(p.money / 2);
            document.getElementById('bet-amount').max = p.money;
        } else {
            document.getElementById('betting-screen').classList.add('hidden');
            handleReveal();
        }
    }

    function submitBet(type) {
        const amt = parseInt(document.getElementById('bet-amount').value);
        const p = players[currentPlayerIdx];

        if (isNaN(amt) || amt <= 0 || amt > p.money) {
            alert("Invalid bet amount!");
            return;
        }

        currentBets.push({ type: type, amount: amt });
        currentPlayerIdx++;
        updateBettingUI();
    }

    function handleReveal() {
        document.getElementById('reveal-screen').classList.remove('hidden');
        const visual = document.getElementById('dice-visual');
        const status = document.getElementById('outcome-text');
        
        visual.innerText = "üé≤üé≤";
        visual.classList.add('shaking');
        status.innerText = "The dealer slams the cup!";

        setTimeout(() => {
            visual.classList.remove('shaking');
            const d1 = Math.floor(Math.random() * 6) + 1;
            const d2 = Math.floor(Math.random() * 6) + 1;
            const sum = d1 + d2;
            const result = (sum % 2 === 0) ? 'Ch≈ç' : 'Han';
            const icons = ['','‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
            
            visual.innerText = `${icons[d1]} ${icons[d2]}`;
            status.innerText = `TOTAL: ${sum} (${result.toUpperCase()})`;

            processResults(result);
        }, 1800);
    }

    function processResults(result) {
        const board = document.getElementById('leaderboard');
        board.innerHTML = "<h3>ROUND RESULTS</h3>";
        let groupWon = false;

        players.forEach((p, i) => {
            const bet = currentBets[i];
            let rowText = "";
            
            if (bet.bankrupt) {
                rowText = `<div class="result-row" style="opacity:0.5"><span>${p.name}</span><span>BANKRUPT</span></div>`;
            } else if (bet.type === result) {
                p.money += bet.amount;
                groupWon = true;
                rowText = `<div class="result-row" style="color:#4caf50"><span>${p.name}</span><span>+${bet.amount} Mon</span></div>`;
            } else {
                p.money -= bet.amount;
                rowText = `<div class="result-row" style="color:#ff5252"><span>${p.name}</span><span>-${bet.amount} Mon</span></div>`;
            }
            board.innerHTML += rowText;
        });

        // VFX: Flash screen
        document.body.className = groupWon ? 'flash-win' : 'flash-loss';
        setTimeout(() => { document.body.className = ''; }, 600);

        document.getElementById('next-btn').classList.remove('hidden');
    }
</script>

</body>
</html>
