<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ch≈ç-Han: The Great Hall</title>
    <style>
        :root {
            --tatami: #c5ba9a;
            --wood: #2c1e16;
            --red: #8b0000;
            --gold: #d4af37;
            --win: #2e7d32;
            --lose: #c62828;
        }

        body {
            background: #000; color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden;
            display: flex; justify-content: center; height: 100vh;
        }

        #game-view {
            width: 100%; max-width: 500px;
            background: var(--wood);
            display: flex; flex-direction: column; position: relative;
        }

        #log-ticker {
            height: 35px; background: #000; color: var(--gold);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; border-bottom: 2px solid var(--gold);
            text-transform: uppercase; letter-spacing: 1px;
        }

        /* THE TATAMI - SPATIAL LAYOUT */
        #tatami {
            flex: 1.2; background: var(--tatami);
            margin: 10px; border: 10px solid #3d2b1f;
            position: relative; display: flex; justify-content: center; align-items: center;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.4);
        }

        .cup { font-size: 90px; z-index: 10; transition: 0.5s; }
        .dice-reveal { font-size: 45px; position: absolute; z-index: 11; display: flex; gap: 15px; }

        /* PLAYER COINS AROUND CUP */
        .player-spot {
            position: absolute; width: 45px; height: 45px;
            border-radius: 50%; border: 2px solid #555;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: bold; background: rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        /* Positioning 8 players in a circle */
        .spot-0 { top: 10%; left: 45%; }
        .spot-1 { top: 25%; right: 10%; }
        .spot-2 { top: 50%; right: 5%; }
        .spot-3 { bottom: 25%; right: 10%; }
        .spot-4 { bottom: 10%; left: 45%; }
        .spot-5 { bottom: 25%; left: 10%; }
        .spot-6 { top: 50%; left: 5%; }
        .spot-7 { top: 25%; left: 10%; }

        /* UI LAYER */
        #ui-layer {
            flex: 1; background: rgba(10,10,10,0.98);
            padding: 15px; border-top: 3px solid var(--gold); z-index: 20;
        }

        .toggle-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .toggle-btn { font-size: 0.7rem; padding: 5px; background: #333; }
        .is-ai { border-color: var(--gold); color: var(--gold); }

        .bet-controls { text-align: center; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        
        button {
            padding: 12px; border: 1px solid var(--gold);
            background: var(--red); color: white; font-weight: bold;
            border-radius: 5px; cursor: pointer;
        }

        #results-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px;
        }
        .res-mini { padding: 5px; font-size: 0.6rem; text-align: center; border-radius: 3px; }

        .active-turn { box-shadow: 0 0 15px var(--gold); transform: scale(1.2); z-index: 15; background: #fff !important; color: #000; }
        .shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0%{transform:rotate(1deg)} 100%{transform:rotate(-1deg)} }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-view">
    <div id="log-ticker">PREPARE THE GAME...</div>

    <div id="tatami">
        <div id="cup" class="cup">üè∫</div>
        <div id="dice-reveal" class="dice-reveal hidden"></div>
        
        <div id="spot-0" class="player-spot spot-0">P1</div>
        <div id="spot-1" class="player-spot spot-1">P2</div>
        <div id="spot-2" class="player-spot spot-2">P3</div>
        <div id="spot-3" class="player-spot spot-3">P4</div>
        <div id="spot-4" class="player-spot spot-4">P5</div>
        <div id="spot-5" class="player-spot spot-5">P6</div>
        <div id="spot-6" class="player-spot spot-6">P7</div>
        <div id="spot-7" class="player-spot spot-7">P8</div>
    </div>

    <div id="ui-layer">
        <div id="setup-ui">
            <p style="text-align:center; font-size:0.8rem; margin:0 0 10px 0;">Configure 8 Gamblers (Tap to Toggle AI)</p>
            <div id="toggle-container" class="toggle-grid"></div>
            <button onclick="startGame()" style="width:100%">OPEN THE DEN</button>
        </div>

        <div id="betting-ui" class="hidden">
            <div class="bet-controls">
                <strong id="p-name">NAME</strong><br>
                <span id="p-money" style="color:var(--gold)">0</span> Mon
                <div style="margin:10px 0;">
                    <button onclick="modBet(-50)" style="padding:5px 15px">-</button>
                    <input type="number" id="bet-amt" value="50" style="width:60px; text-align:center; background:#000; color:#fff; border:1px solid var(--gold);">
                    <button onclick="modBet(50)" style="padding:5px 15px">+</button>
                </div>
            </div>
            <div class="btn-grid">
                <button onclick="placeBet('Ch≈ç')">CH≈å (Even)</button>
                <button onclick="placeBet('Han')">HAN (Odd)</button>
            </div>
        </div>

        <div id="results-ui" class="hidden">
            <h3 id="outcome-msg" style="text-align:center; margin:0;"></h3>
            <div id="results-grid"></div>
            <div class="btn-grid">
                <button id="call-cheat-btn" style="background:orange; color:black;" onclick="callCheat()">CALL CHEAT</button>
                <button onclick="nextRound()">NEXT ROUND</button>
            </div>
        </div>
    </div>
</div>

<script>
    let players = [];
    let bets = [];
    let curIdx = 0;
    let houseCheat = false;
    let currentResult = "";
    const icons = ['','‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];

    // 1. Setup Toggle UI
    const toggleContainer = document.getElementById('toggle-container');
    let config = Array(8).fill(false); // false = Human, true = AI
    for(let i=0; i<8; i++) {
        const btn = document.createElement('button');
        btn.className = 'toggle-btn';
        btn.innerText = `P${i+1}: HUMAN`;
        btn.onclick = () => {
            config[i] = !config[i];
            btn.innerText = `P${i+1}: ${config[i] ? 'CPU' : 'HUMAN'}`;
            btn.classList.toggle('is-ai');
        };
        toggleContainer.appendChild(btn);
    }

    function ticker(msg) { document.getElementById('log-ticker').innerText = msg; }

    function startGame() {
        players = config.map((isAI, i) => ({
            name: (isAI ? "CPU " : "P") + (i+1),
            money: 1000,
            isAI: isAI,
            id: i
        }));
        document.getElementById('setup-ui').classList.add('hidden');
        newRound();
    }

    function newRound() {
        curIdx = 0; bets = []; houseCheat = false;
        document.getElementById('cup').style.transform = "translateY(0)";
        document.getElementById('dice-reveal').classList.add('hidden');
        document.getElementById('results-ui').classList.add('hidden');
        document.querySelectorAll('.player-spot').forEach(s => {
            s.style.background = 'rgba(0,0,0,0.2)';
            s.innerText = players[parseInt(s.id.split('-')[1])].name;
            s.classList.remove('active-turn');
        });
        processNextTurn();
    }

    function processNextTurn() {
        if(curIdx < 8) {
            let p = players[curIdx];
            if(p.money <= 0) { curIdx++; processNextTurn(); return; }

            // Highlight current player on tatami
            document.querySelectorAll('.player-spot').forEach(s => s.classList.remove('active-turn'));
            const spot = document.getElementById('spot-'+curIdx);
            spot.classList.add('active-turn');

            if(p.isAI) {
                ticker(p.name + " is placing bet...");
                setTimeout(() => {
                    let type = Math.random() > 0.5 ? 'Ch≈ç' : 'Han';
                    let amt = Math.floor(Math.random() * 150) + 20;
                    if(amt > p.money) amt = p.money;
                    confirmBet(type, amt);
                }, 1000);
            } else {
                ticker("Your turn, " + p.name);
                document.getElementById('betting-ui').classList.remove('hidden');
                document.getElementById('p-name').innerText = p.name;
                document.getElementById('p-money').innerText = p.money;
            }
        } else {
            document.getElementById('betting-ui').classList.add('hidden');
            revealDice();
        }
    }

    function modBet(v) {
        let inp = document.getElementById('bet-amt');
        let val = parseInt(inp.value) + v;
        if(val < 10) val = 10;
        if(val > players[curIdx].money) val = players[curIdx].money;
        inp.value = val;
    }

    function placeBet(type) {
        let amt = parseInt(document.getElementById('bet-amt').value);
        confirmBet(type, amt);
    }

    function confirmBet(type, amt) {
        bets[curIdx] = { type, amt };
        const spot = document.getElementById('spot-'+curIdx);
        spot.innerText = amt;
        spot.style.background = (type === 'Ch≈ç') ? '#444' : '#888';
        
        document.getElementById('betting-ui').classList.add('hidden');
        curIdx++;
        setTimeout(processNextTurn, 500);
    }

    function revealDice() {
        ticker("DEALER SHAKES THE CUP...");
        const cup = document.getElementById('cup');
        cup.classList.add('shake');

        setTimeout(() => {
            cup.classList.remove('shake');
            cup.style.transform = "translateY(-120px)";
            
            let d1 = Math.floor(Math.random()*6)+1;
            let d2 = Math.floor(Math.random()*6)+1;
            if(Math.random() < 0.15) houseCheat = true;

            let sum = d1 + d2;
            currentResult = (sum % 2 === 0) ? 'Ch≈ç' : 'Han';
            document.getElementById('dice-reveal').innerHTML = `<span>${icons[d1]}</span><span>${icons[d2]}</span>`;
            document.getElementById('dice-reveal').classList.remove('hidden');
            
            ticker("RESULT: " + currentResult.toUpperCase());
            showFinalResults();
        }, 2000);
    }

    function showFinalResults() {
        document.getElementById('results-ui').classList.remove('hidden');
        document.getElementById('outcome-msg').innerText = currentResult.toUpperCase();
        const grid = document.getElementById('results-grid');
        grid.innerHTML = "";

        players.forEach((p, i) => {
            const b = bets[i];
            if(!b) return;
            const won = b.type === currentResult;
            const card = document.createElement('div');
            card.className = 'res-mini';
            card.style.background = won ? 'var(--win)' : 'var(--lose)';
            card.innerHTML = `<strong>${p.name}</strong><br>${won?'+':'-'}${b.amt}`;
            grid.appendChild(card);
            
            // Update Money
            if(won) p.money += b.amt; else p.money -= b.amt;
        });
    }

    function callCheat() {
        document.getElementById('call-cheat-btn').classList.add('hidden');
        if(houseCheat) {
            ticker("CAUGHT! Dealer was cheating! Everyone Wins!");
            players.forEach((p, i) => { if(bets[i]) p.money += (bets[i].amt * 2); });
        } else {
            ticker("INNOCENT! Dealer is furious. Fines for everyone!");
            players.forEach(p => p.money = Math.floor(p.money * 0.8));
        }
        showFinalResults();
    }

    function nextRound() {
        newRound();
    }
</script>
</body>
</html>
